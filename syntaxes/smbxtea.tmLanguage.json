{
	"$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
	"name": "SMBX Tea",
	"scopeName": "source.smt",


	"patterns": [
		{
			"include": "#comment"
		},
		{
			"include": "#declare"
		},
		{
			"include": "#keywords"
		},
		{
			"include": "#expression"
		}
	],


	"repository": {
		"keywords": {
			"patterns": [{
				"name": "keyword.control.smbxtea",
				"match": "\\b(As|Call|Case|Dim|Else|ElseIf|End|Export|For|GoTo|GoSub|If|next|Return|Script|Select|Step|Then|To|While|With)\\b"
			},
			{
				"include": "#support"
			}]
		},
		"support" : {
			"name":"support.name.buildin_v",
			"patterns": [{
				"name": "keyword.control.smbxtea",
				"match": "\\b(Array|GVal|ReDim|v|Val)\\b"
			}]
		},
		"strings": {
			"name": "string.quoted.double.smbxtea",
			"begin": "\"",
			"end": "\"",
			"patterns": [
				{
					"name": "constant.character.escape.smbxtea",
					"match": "\\\\."
				}
			]
		},
		"numeric":{
			"patterns": [{
				"name": "constant.numeric.smbxtea",
				"match": "\\b([0-9]+\\.?[0-9]*)\\b"
			}]
		},
		"comment": {
			"name" : "comment.line",
			"patterns": [
				{
					"name" : "comment.line",
					"match": "'.*$"
				}
			]
		},
		"buildin_type":{
			"patterns": [{
				"name": "storage.type.smbxtea",
				"match": "\\b(Integer|Double|Long|Byte)\\b"
			}]
		},
		"type":{
			"patterns": [{
				"include": "#buildin_type"
			}, {
				"name": "entity.name.type.smbxtea",
				"match": "\\b[_a-zA-Z][_a-zA-Z0-9]*\\b"
			}]
		},
		"identifier": {
			"patterns": [{
				"name": "entity.name.smbxtea",
				"match": "\\b[_a-zA-Z][_a-zA-Z0-9]*\\b"
			}]
		},
		"operators":{
			"patterns": [{
				"name": "keyword.operator.smbxtea",
				"match": "([+\\-\\*/<>\\?\\!.]|\\bAnd\\b|\\bOr\\b|\\bNot\\b|\\bXor\\b|\\bEqv\\b|\\bImp\\b)"
			}]
		},
		"expression":{
			"patterns": [
			{
				"include": "#numeric"
			},
			{
				"include": "#strings"
			},
			{
				"include": "#call_function"
			},
			{
				"include": "#identifier"
			},
			{
				"include": "#operators"
			}]
		},


		"declare":{
			"patterns": [
				{
					"include": "#declare_variable"
				},
				{
					"include": "#declare_function"
				}
			]
		},
		"declare_variable":{
			"name": "meta.var.declare",
			"match": "(\\bDim\\s+)([_a-zA-Z][_a-zA-Z0-9]*)(\\s+As\\s+)([_a-zA-Z][_a-zA-Z0-9]*\\b)(.*)",
			"captures": {
				"1":{
					"name":"keyword.control.define"
				},
				"2":{
					"patterns": [{
						"include": "#identifier"
					}]},
				"3":{
					"name":"keyword.control.define"
				},
				"4":{
					"patterns":[{
						"include": "#type"
					}]},
				"5":{
					"patterns": [{
						"include": "#expression"
					}]}
				}
		},
		"declare_function":{
			"name" : "meta.function.block",
			"begin": "((?:\\bExport\\s+)?(?:\\bScript\\s+))([_a-zA-Z][_a-zA-Z0-9]*)(\\([\\s\\S]*\\))",
			"end": "(\\bEnd\\s+Script\\b)",
			"beginCaptures": {
				"0":{
					"name": "declare.function.begin"
				},
				"1":{
					"name": "keyword.control.function"
				},
				"2":{
					"name": "entity.name.function.smbxtea",
					"patterns": [{
					"include": "#identifier"
				}]},
				"3":{
					"patterns": [{
						"include": "#declare_param"
				}]}
			},
			"endCaptures": {
				"0":{
					"name":"declare.function.end"
				},
				"1":{
					"name":"keyword.control.function"
				}
			},
			"patterns": [{
				"include": "#block"
			}]
		},
		"declare_param" : {
			"patterns": [{
				"name": "meta.function.parameters",
				"begin": "\\(",
				"end": "\\)",
				"patterns": [
					{
						"include": "#declare_params_return"
					},
					{
						"include": "#declare_params_variable"
					}
				]
			}]
		},
		"declare_params_variable":{
			"name": "meta.var.declare",
			"begin": "([_a-zA-Z][_a-zA-Z0-9]*)(\\s+As\\s+)([_a-zA-Z][_a-zA-Z0-9]*)([^,]*)",
			"end": "\\s*(\\,)",
			"beginCaptures": {
			"1":{
				"patterns": [{
					"include": "#identifier"
				}]},
			"2":{
				"name" : "keyword.control.type_reflesh"
			},
			"3":{
				"patterns":[{
					"include": "#type"
				}]},
			"4":{
				"patterns": [{
					"include": "#expression"
				}]}
			}
		},
		"declare_params_return":{
			"name": "meta.return-type",
			"begin": "\\b(Return)\\s+([_a-zA-Z][_a-zA-Z0-9]*)",
			"end": "\\)",
			"beginCaptures": {
				"1":{
					"name":"keyword.control.function_return"
				},
				"2":{
					"patterns": [{
						"include": "#type"
				}]}
			}
		},


		"call_function":{
			"patterns": [{
				"match": "([_a-zA-Z][_a-zA-Z0-9]*(?<!Array|GVal|ReDim|v|Val))(\\((([^/]|/(?!\\*))*)((/\\*.*?\\*/)(([^/]|/(?![*/]))*))*\\))(\\b'.*)",
				"captures": {
					"1": {
						"name": "entity.name.function.smbxtea",
						"patterns": [{
							"include": "#identifier"
						}]
					},
					"2": {
						"name": "meta.function.parameters.smbxtea",
						"patterns": [{
							"include": "#params"
						}]
					},
					"3": {
						"name" : "meta.function.comment.smbxtea",
						"patterns": [{
							"include": "#comment"
						}]
					}
				}
			}]
		},
		"params":{
			"name" : "meta.function.callparameters",
			"begin": "\\(",
			"end": "\\)",
			"patterns": [{
				"include": "#expression"
			}]
		},


		"block":{
			"name": "meta.block.smbxtea",
			"patterns": [{
				"include": "#comment"
			},
			{
				"include": "#declare_variable"
			},
			{
				"include": "#keywords"
			},
			{
				"include": "#exprssion"
			}]
		}
	}
}